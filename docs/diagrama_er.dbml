// DBML para Personal Technology - Sistema de Gestión de Servicios TI
// Generado para dbdiagram.io
// Docs: https://dbml.dbdiagram.io/docs

// Tabla de usuarios de Django (base)
Table auth_user {
  id integer [primary key]
  password varchar(128) [not null]
  last_login timestamp
  is_superuser boolean [not null, default: false]
  username varchar(150) [not null, unique]
  first_name varchar(150) [not null]
  last_name varchar(150) [not null]
  email varchar(254) [not null]
  is_staff boolean [not null, default: false]
  is_active boolean [not null, default: true]
  date_joined timestamp [not null, default: `CURRENT_TIMESTAMP`]
}

// Tabla de perfiles de usuario
Table accounts_profile {
  id integer [primary key]
  user_id integer [not null, unique]
  role varchar(20) [not null, default: 'client']
  phone varchar(20)
  address text
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
  updated_at timestamp [default: `CURRENT_TIMESTAMP`]
}

// Tabla de clientes
Table services_client {
  id integer [primary key]
  name varchar(100) [not null]
  email varchar(254) [not null, unique]
  phone varchar(20)
  company varchar(100)
  address text
  client_type varchar(20) [not null, default: 'service']
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
  updated_at timestamp [default: `CURRENT_TIMESTAMP`]

  indexes {
    email [name: 'idx_services_client_email']
    company [name: 'idx_services_client_company']
  }
}

// Tabla de servicios técnicos
Table services_service {
  id integer [primary key]
  title varchar(200) [not null]
  description text
  service_type varchar(50) [not null]
  status varchar(20) [not null, default: 'pending']
  priority varchar(20) [not null, default: 'medium']
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
  updated_at timestamp [default: `CURRENT_TIMESTAMP`]
  completed_at timestamp
  client_id integer
  assigned_to_id integer

  indexes {
    status [name: 'idx_services_service_status']
    client_id [name: 'idx_services_service_client_id']
    assigned_to_id [name: 'idx_services_service_assigned_to']
  }
}

// Tabla de reportes técnicos
Table services_technicalreport {
  id integer [primary key]
  title varchar(200) [not null]
  diagnosis text
  solution text
  recommendations text
  status varchar(20) [not null, default: 'draft']
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
  updated_at timestamp [default: `CURRENT_TIMESTAMP`]
  service_id integer [not null]
  technician_id integer
}

// Tabla de equipos/inventario
Table inventory_equipment {
  id integer [primary key]
  name varchar(100) [not null]
  model varchar(100)
  serial_number varchar(100) [unique]
  equipment_type varchar(50) [not null]
  status varchar(20) [not null, default: 'available']
  specifications text
  purchase_date date
  cost decimal(10,2)
  assigned_to_id integer
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
  updated_at timestamp [default: `CURRENT_TIMESTAMP`]

  indexes {
    status [name: 'idx_inventory_equipment_status']
    equipment_type [name: 'idx_inventory_equipment_type']
  }
}

// Tabla de cotizaciones
Table quotes_quote {
  id integer [primary key]
  title varchar(200) [not null]
  description text
  status varchar(20) [not null, default: 'draft']
  estimated_cost decimal(12,2)
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
  valid_until date
  client_id integer [not null]
  created_by_id integer
}

// Tabla de reportes generales
Table reports_report {
  id integer [primary key]
  title varchar(200) [not null]
  content text
  report_type varchar(50) [not null]
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
  service_id integer [not null]
  created_by_id integer
}

// Tabla relacional servicios-equipos (muchos a muchos)
Table services_service_equipment {
  id integer [primary key]
  service_id integer [not null]
  equipment_id integer [not null]
  assigned_at timestamp [default: `CURRENT_TIMESTAMP`]
  returned_at timestamp
}

// Relaciones (References)

// Perfil pertenece a un usuario (1:1)
Ref: accounts_profile.user_id > auth_user.id

// Servicio pertenece a un cliente (N:1)
Ref: services_service.client_id > services_client.id

// Servicio asignado a un técnico (N:1)
Ref: services_service.assigned_to_id > auth_user.id

// Reporte técnico pertenece a un servicio (1:1)
Ref: services_technicalreport.service_id > services_service.id

// Reporte técnico creado por un técnico (N:1)
Ref: services_technicalreport.technician_id > auth_user.id

// Equipo asignado a un usuario (N:1)
Ref: inventory_equipment.assigned_to_id > auth_user.id

// Cotización pertenece a un cliente (N:1)
Ref: quotes_quote.client_id > services_client.id

// Cotización creada por un usuario (N:1)
Ref: quotes_quote.created_by_id > auth_user.id

// Reporte pertenece a un servicio (N:1)
Ref: reports_report.service_id > services_service.id

// Reporte creado por un usuario (N:1)
Ref: reports_report.created_by_id > auth_user.id

// Relación muchos a muchos: servicios y equipos
Ref: services_service_equipment.service_id > services_service.id
Ref: services_service_equipment.equipment_id > inventory_equipment.id